Figure 3. The overall framework of SmartEdit. For the instruction, we first append the r [IMG] tokens to the end of instruction c . Together with image x , they will be sent into LLaVA, which can then obtain the hidden states corresponding to these r [IMG] tokens. Then the hidden state is sent into the QFormer and gets feature f . Subsequently, the image feature v output by the image encoder E ϕ interacts with f through a bidirectional interaction module (BIM), resulting in f ′ and v ′ . The f ′ and v ′ are input into the diffusion models to achieve the instruction-based image editing task.